# Migration `20220405020559-create-data-migrations`

This migration has been generated by tiennt at 4/5/2022, 9:05:59 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "Meta" (
"id" TEXT NOT NULL,
"key" TEXT NOT NULL,
"value" TEXT NOT NULL,
"type" TEXT NOT NULL,
"draftProfileId" TEXT ,
PRIMARY KEY ("id"),
FOREIGN KEY ("draftProfileId") REFERENCES "DraftProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "DraftProfile" (
"id" TEXT NOT NULL,
"fullName" TEXT NOT NULL,
"nationalId" TEXT ,
"phoneNumber" TEXT ,
"birthday" DATETIME ,
"activated" BOOLEAN NOT NULL DEFAULT true,
"createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "ContainerType" (
"id" TEXT NOT NULL,
"slug" TEXT NOT NULL,
"name" TEXT NOT NULL,
PRIMARY KEY ("id"))

CREATE TABLE "ContainerHost" (
"id" TEXT NOT NULL,
"name" TEXT NOT NULL,
"contact" TEXT ,
"note" TEXT ,
PRIMARY KEY ("id"))

CREATE TABLE "Container" (
"id" TEXT NOT NULL,
"slug" TEXT ,
"name" TEXT NOT NULL,
"note" TEXT ,
"capacity" INTEGER  DEFAULT 0,
"updatedAt" DATETIME NOT NULL,
"createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
"containerTypeId" TEXT NOT NULL,
"containerHostId" TEXT ,
PRIMARY KEY ("id"),
FOREIGN KEY ("containerHostId") REFERENCES "ContainerHost"("id") ON DELETE SET NULL ON UPDATE CASCADE,

FOREIGN KEY ("containerTypeId") REFERENCES "ContainerType"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "ContainerRole" (
"id" TEXT NOT NULL,
"slug" TEXT NOT NULL,
"name" TEXT NOT NULL,
"containerId" TEXT ,
"profileId" TEXT ,
PRIMARY KEY ("id"),
FOREIGN KEY ("containerId","profileId") REFERENCES "ProfilesOnContainers"("containerId","profileId") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "ProfilesOnContainers" (
"containerId" TEXT NOT NULL,
"profileId" TEXT NOT NULL,
"note" TEXT ,
"createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("containerId","profileId"),
FOREIGN KEY ("containerId") REFERENCES "Container"("id") ON DELETE CASCADE ON UPDATE CASCADE,

FOREIGN KEY ("profileId") REFERENCES "DraftProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "RW_DataMigration" (
"version" TEXT NOT NULL,
"name" TEXT NOT NULL,
"startedAt" DATETIME NOT NULL,
"finishedAt" DATETIME NOT NULL,
PRIMARY KEY ("version"))

CREATE UNIQUE INDEX "ContainerType.slug_unique" ON "ContainerType"("slug")

CREATE UNIQUE INDEX "ContainerRole.slug_unique" ON "ContainerRole"("slug")

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20220405020559-create-data-migrations
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,88 @@
+datasource DS {
+  provider = "sqlite"
+  url = "***"
+}
+
+generator client {
+  provider      = "prisma-client-js"
+  binaryTargets = env("BINARY_TARGET")
+}
+
+model Meta {
+  id             String        @id @default(cuid())
+  key            String
+  value          String
+  type           String
+  DraftProfile   DraftProfile? @relation(fields: [draftProfileId], references: [id])
+  draftProfileId String?
+}
+
+model DraftProfile {
+  id          String                 @id @default(cuid())
+  fullName    String
+  nationalId  String?
+  phoneNumber String?
+  birthday    DateTime?
+  meta        Meta[]
+  activated   Boolean                @default(value: true)
+  createdAt   DateTime               @default(now())
+  containers  ProfilesOnContainers[]
+}
+
+model ContainerType {
+  id         String      @id @default(cuid())
+  slug       String      @unique
+  name       String
+  containers Container[]
+}
+
+model ContainerHost {
+  id         String      @id @default(cuid())
+  name       String
+  contact    String?
+  note       String?
+  containers Container[]
+}
+
+model Container {
+  id              String                 @id @default(cuid())
+  slug            String?
+  name            String
+  note            String?
+  profiles        ProfilesOnContainers[]
+  host            ContainerHost?         @relation(fields: [containerHostId], references: [id])
+  type            ContainerType          @relation(fields: [containerTypeId], references: [id])
+  capacity        Int?                   @default(value: 0)
+  updatedAt       DateTime               @updatedAt
+  createdAt       DateTime               @default(now())
+  containerTypeId String
+  containerHostId String?
+}
+
+model ContainerRole {
+  id          String                @id @default(cuid())
+  slug        String                @unique
+  name        String
+  container   ProfilesOnContainers? @relation(fields: [containerId, profileId], references: [containerId, profileId])
+  containerId String?
+  profileId   String?
+}
+
+model ProfilesOnContainers {
+  container   Container       @relation(fields: [containerId], references: [id])
+  containerId String
+  profile     DraftProfile    @relation(fields: [profileId], references: [id])
+  profileId   String
+  role        ContainerRole[]
+  note        String?
+  createdAt   DateTime        @default(now())
+
+  @@id([containerId, profileId])
+}
+
+model RW_DataMigration {
+  version    String   @id
+  name       String
+  startedAt  DateTime
+  finishedAt DateTime
+}
```


